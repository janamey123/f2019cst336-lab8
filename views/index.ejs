<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>US Quiz (Express)</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body class="text-center">

<h1 class="jumbotron"> US Geography Quiz <br> Express Version </h1>

<h3><span id="markImg1"></span> What is the capital of California?</h3>
<input type="text" id="q1">
<br><br>
<div id="q1Feedback"></div>
<br>

<h3><span id="markImg2"></span>What is the longest river?</h3>
<select id="q2">
    <option value="">Select One</option>
    <option value="ms">Mississippi</option>
    <option value="mo">Missouri</option>
    <option value="co">Colorado</option>
    <option value="de">Delaware</option>
</select>
<br><br>
<div id="q2Feedback"></div>
<br>

<h3><span id="markImg3"></span>What presidents are carved into mount Rushmore?</h3>
<input type="checkbox" id="Jackson"> <label for="Jackson"> A. Jackson </label>
<input type="checkbox" id="Franklin"> <label for="Franklin">B. Franklin </label>
<input type="checkbox" id="Jefferson"> <label for="Jefferson">T. Jefferson</label>
<input type="checkbox" id="Roosevelt"> <label for="Roosevelt">T. Roosevelt</label>
<br><br>
<div id="q3Feedback"></div>
<br>

<h3><span id="markImg4"></span>What is the smallest US state?</h3>
<div id="choices"></div>
<br><br>
<div id="q4Feedback"></div>
<br>

<h3><span id="markImg5"></span>Which is the correct seal of California?</h3>
<img src="/img/seal1.png" alt="seal1" class="q5choice" id="seal1">
<img src="/img/seal2.png" alt="seal2" class="q5choice" id="seal2">
<img src="/img/seal3.png" alt="seal3" class="q5choice" id="seal3">

<br><br>
<div id="q5Feedback"></div>
<br>

<h3><span id="markImg6"></span>What part of the U.S. does Route 66 go through?</h3>
<div id="q6Choices"></div>
<div id="q6Feedback"></div>
<br>

<h3><span id="markImg7"></span>Which of these states was not one of the original 13 colonies?</h3>
<select id="q7">
    <option value="">Select One</option>
    <option value="ct">Connecticut</option>
    <option value="vt">Vermont</option>
    <option value="sc">South Carolina</option>
    <option value="nj">New Jersey</option>
    <option value="ny">New York</option>
    <option value="pa">Pennsylvania</option>
</select>
<br><br>
<div id="q7Feedback"></div>
<br>

<h3><span id="markImg8"></span>Which of these National Parks are located in California?</h3>
<input type="checkbox" id="Yosemite"> <label for="Yosemite">Yosemite N.P.</label>
<input type="checkbox" id="DeathValley"> <label for="DeathValley">Death Valley N.P.</label>
<input type="checkbox" id="MonumentValley"> <label for="MonumentValley">Monument Valley N.P.</label>
<input type="checkbox" id="JoshuaTree"> <label for="JoshuaTree">Joshua Tree N.P.</label>
<input type="checkbox" id="Zion"> <label for="Zion">Zion N.P.</label>
<br><br>
<div id="q8Feedback"></div>
<br>

<h3 id="validationFdbk" class="bg-danger text-white"></h3>
<!-- Step 2. Add the submit class to help find the button with jQuery-->
<button class="btn btn-outline-success submit"> Submit Quiz</button>
<br><br>
<h2 id="totalScore"></h2>
<br><br>
<h2 id="prevScores">Previous scores: </h2>



<h2 id="totalScore" class="text-info"></h2>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>
    $(document).ready(function () {

        //Global Variables
        var score = 0;
        var allScores;

        if (window.localStorage) {
            allScores = [window.localStorage.getItem("allScores")] || [];
        } else {
            allScores = [parseInt($("#prevScores").html() || [])];
        }

        //event Listener
        //"Submit Quiz" button
        $("button").on("click", gradeQuiz);

        //Question 5 images
        $(".q5Choice").on("click", function () {
            $(".q5Choice").css("background", "");
            $(this).css("background", "rgb(255, 255, 0)");
        });

        displayQ4Choices();
        displayQ6Choices();
        //functions
        function displayQ4Choices() {
            let q4ChoicesArray = ["Maine", "Rhode Island", "Maryland", "Delaware"];
            //q4ChoicesArray = _.shuffle(q4ChoicesArray);
            for (let i = 0; i < q4ChoicesArray.length; i++) {
                $("#q4Choices").append(`<input type="radio" name="q4" id="${q4ChoicesArray[i]}" value="${q4ChoicesArray[i]}"> <label for="${q4ChoicesArray[i]}">${q4ChoicesArray[i]}</label>`);
            }
        }//displayQ4Choices

        function displayQ6Choices() {
            let q6ChoicesArray = ["Deep South", "Northeast", "Southwest", "Pacific Northwest"];
            //q6ChoicesArray = _.shuffle(q6ChoicesArray);
            for (let i = 0; i < q6ChoicesArray.length; i++) {
                $("#q6Choices").append(`<input type="radio" name="q6" id="${q6ChoicesArray[i]}" value="${q6ChoicesArray[i]}"> <label for="${q6ChoicesArray[i]}">${q6ChoicesArray[i]}</label>`);
            }
        }// displayQ6Choices

        function isFormValid() {
            let isValid = true;
            if ($("#q1").val() == "") {
                isValid = false;
                $("#validationFdbk").html("Question 1 was not answered");
            }
            return isValid;
        }// isFormValid

        function rightAnswer(index) {
            $(`#q${index}Feedback`).html("Correct!");
            $(`#q${index}Feedback`).attr("class", "bg-success text-white");
            $(`#markImg${index}`).html("<img src='img/checkmark.png' alt='checkmark'>");
            score += 12.5;
        }// rightAnswer

        function wrongAnswer(index) {
            $(`#q${index}Feedback`).html("Incorrect!");
            $(`#q${index}Feedback`).attr("class", "bg-warning text-white");
            $(`#markImg${index}`).html("<img src='img/xmark.png' alt='xmark'>");
        }// wrongAnswer

        function gradeQuiz() {


            // BEWARE THIS ERROR:
            // SyntaxError: Unexpected token q in JSON at position 0
            // It means you forgot to convert your data object to a string for transmission

            // Step 1. Add a click handler for the button
            // (see the button for Step 2.)
            $(".submit").on("click touchstart", function (e) {

                // Step 3. Make the AJAX POST call back to the server
                // making sure to get values of the inputs AND
                // to convert the data to a string using JSON.stringify()
                $.ajax({
                    url: "/",
                    method: "post",
                    contentType: "application/json",
                    data: JSON.stringify({
                        questions: {
                            "1": $("#q1").val(),
                           // "2": $("#q2").val(),
                           // "3": $("#Jefferson").is(":checked") && $("#Roosevelt").is(":checked")
                        }
                    }),
                    dataType: "json",
                    success: function (result) {
                        // Step 5. Process the results by changing the HTML
                        // to display the results of the quiz
                        console.log('result of call to POST router', result);
                        $("#q1").val(result.original.questions["1"]);
                    },
                    error: function (xhr, status) {
                        console.log('error calling to POST router', status);
                    },
                    complete: function () {
                    }
                });
            });

            // allScores.push(score);
            // if (window.localStorage) {
            //   window.localStorage.setItem("allScores", allScores);
            // }
            // for (let i = 0; i < allScores.length; i++) {
            //   if (allScores[i] != null) {
            //     $("#prevScores").append(`${allScores[i]}  `);
            //   }
            // }

            if (score < 80) {
                $("#totalScore").attr("class", "text-danger");
            } else {
                $("#totalScore").attr("class", "text-success");
            }
            if (score == 100) {
                $("#totalScore").html(`Congratulations! You reached a total score of ${score} points!`);
            } else {
                $("#totalScore").html(`Total Score: ${score}`);
            }
        }// gradeQuiz
    });//ready
</script>

</body>
</html>

